<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>GartenIS - Virtueller Rundgang Herrenhäuser Gärten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root { --gap:16px; --accent:#0b3a66; --btn-blue:#0d6efd; }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#f4f6f8;color:#222;}
    header{display:flex;align-items:center;gap:12px;padding:18px;background:linear-gradient(180deg,var(--accent),#0d4771);color:#fff;}
    header h1{margin:0;font-size:20px;flex:1;text-shadow:0 1px 0 rgba(0,0,0,0.15);}
    .visit-link{color:#fff;text-decoration:none;background:rgba(255,255,255,0.08);padding:8px 12px;border-radius:8px;font-weight:600;}
    .visit-link:hover{background:rgba(255,255,255,0.14);}
    main{max-width:1100px;margin:20px auto;padding:0 16px 40px;display:flex;flex-direction:column;gap:var(--gap);}
    .card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 8px 24px rgba(16,24,40,0.06);}
    .intro strong{display:block;margin-bottom:8px;color:var(--accent);font-size:15px;}
    .intro p{margin:0 0 10px 0;color:#444;line-height:1.45;}
    .cam-header{display:flex;justify-content:center;align-items:center;gap:12px;}
    .cam-header h2{margin:0;color:var(--accent);font-size:16px;text-align:center;}
    #viewWindow{width:100%;height:56vw;max-height:68vh;min-height:300px;background:#000;border-radius:10px;overflow:hidden;position:relative;display:flex;align-items:center;justify-content:center;color:#fff;}
    @media (max-width:900px){#viewWindow{height:55vh;}}
    .controls-row{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:10px;}
    button{cursor:pointer;border:0;padding:8px 12px;border-radius:8px;font-weight:600;}
    .btn-primary{background:var(--btn-blue);color:#fff;}
    .btn-secondary{background:#eef2f6;color:var(--accent);}
    section.stations{margin-top:4px;}
    section.stations h3{margin:0 0 8px 0;color:var(--accent);}
    .stations-text{color:#444;margin-top:6px;}
    #mapStations{width:100%;height:420px;border-radius:8px;overflow:hidden;margin-top:12px;}
    .map-controls{display:flex;gap:8px;align-items:center;margin-top:8px;}
    #locateBtn{background:var(--btn-blue);color:#fff;border:none;padding:8px 12px;border-radius:8px;font-weight:600;}
    footer{margin-top:18px;text-align:center;color:#666;font-size:13px;}
    .muted{color:#666;font-size:13px;}
  </style>
</head>
<body>
  <header id="mainHeader">
    <h1>GartenIS - Virtueller Rundgang Herrenhäuser Gärten</h1>
    <a class="visit-link" href="https://herrenhaeuser-gaerten.hannover.de/Herrenhausen-erleben" target="_blank">Herrenhäuser Gärten Hannover</a>
  </header>

  <main id="mainContent">
    <div class="card intro" id="introCard">
      <strong>Kurzinfo</strong>
      <p>
        Die AR‑Anwendung bietet einen interaktiven, virtuellen Rundgang durch die Herrenhäuser Gärten. Besucherinnen und Besucher können über das AR‑Erlebnis Würfel‑Stationen in ihrer Umgebung platzieren, zu jedem gesetzten Punkt weiterführende Informationen abrufen und so historische Hintergründe, besondere Pflanzen und gestalterische Details der Anlage kompakt erleben.
      </p>
      <p>
        Die Anwendung kombiniert visuelle Modelle, erklärende Texte und Links und ergänzt damit die reale Besichtigung durch zusätzliche Kontextinformationen zu Brunnen, Beeten und Gartenarchitektur.
      </p>
    </div>

    <div class="card" id="cameraCard">
      <div class="cam-header">
        <h2>Experience Herrenhausen Gardens in Hanover virtually!</h2>
      </div>

      <!-- Keine Kameravorschau; nur Platzhalter und synchroner Start -->
      <div id="viewWindow">
        <div style="text-align:center;padding:18px;">
          <div style="font-weight:700;font-size:18px;margin-bottom:6px;">AR startet in neuem Tab</div>
          <div style="opacity:0.9;margin-bottom:12px;">Tippe auf <strong>Start AR</strong>, um das WebXR Hit‑Test Erlebnis zu öffnen.</div>
          <div style="font-size:13px;color:#e6f0ff;">Hinweis: WebXR/Hit‑Test läuft nur auf unterstützten Geräten/Browsers über HTTPS.</div>
        </div>
      </div>

      <div class="controls-row" style="margin-top:12px;" id="controlsRow">
        <div style="margin-right:auto;color:#666;">Nur Start AR nötig; Vorschau entfällt.</div>
        <button id="startARBtn" class="btn-primary">Start AR</button>
      </div>
    </div>

    <section class="card stations" id="stationsCard">
      <h3>Stationen des virtuellen Rundgangs</h3>
      <p class="stations-text">
        Die Karte unten zeigt Ihre aktuelle Position sowie die Stationen des virtuellen Rundgangs zur Orientierung in den Herrenhäuser Gärten. Tippe auf "Meine Position", um die Karte zu zentrieren.
      </p>

      <div id="mapStations"></div>
      <div class="map-controls">
        <button id="locateBtn">Meine Position</button>
        <div style="color:#666;font-size:13px;">Erlaube Standortzugriff, damit deine Position und die Stationen korrekt angezeigt werden.</div>
      </div>
    </section>

    <footer id="mainFooter">© Lars Niehsen - not for private or commercial use allowed!</footer>
  </main>

  <!-- START AR: neues Tab synchron öffnen und direkt zu HitTest.html navigieren -->
  <script>
    (function () {
      const startBtn = document.getElementById('startARBtn');

      startBtn.addEventListener('click', (ev) => {
        // Öffne synchron ein neues Tab/Fenster — muss direkt im Klick-Event erfolgen
        const newWin = window.open('', '_blank');

        if (!newWin) {
          alert('Das Öffnen des AR-Tabs wurde vom Browser blockiert. Erlaube Popups oder öffne HitTest.html manuell.');
          return;
        }

        // Sofortige Navigation zur AR-Seite (HitTest.html muss im gleichen Verzeichnis liegen)
        newWin.location.href = 'HitTest.html';
      });
    })();
  </script>

  <!-- Leaflet für Karte -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Karteninitialisierung: Texte, Marker und Nutzerevents wie im Original beibehalten -->
  <script>
    (function () {
      const mapEl = document.getElementById('mapStations');
      if (!mapEl) return;

      try {
        const map = L.map(mapEl).setView([52.374, 9.716], 16);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Beispielstationen (beibehalten; ersetze durch deine Daten falls gewünscht)
        const stations = [
          { title: 'Großer Garten', coords: [52.3745, 9.7155] },
          { title: 'Berggarten', coords: [52.3751, 9.7172] }
        ];

        stations.forEach(s => {
          L.marker(s.coords).addTo(map).bindPopup(`<strong>${s.title}</strong>`);
        });

        // locate button
        document.getElementById('locateBtn').addEventListener('click', () => {
          map.locate({ setView: true, maxZoom: 17 });
        });

        map.on('locationfound', (e) => {
          L.circle(e.latlng, { radius: e.accuracy ? e.accuracy / 2 : 5, color: '#0d6efd' }).addTo(map);
        });
      } catch (err) {
        console.warn('Leaflet init failed', err);
      }
    })();
  </script>
</body>
</html>
